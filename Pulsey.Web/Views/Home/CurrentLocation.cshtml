<!--<script src="gears_init.js"></script>-->
<script src="http://code.google.com/apis/gears/gears_init.js"></script>
<script>!window.google && document.write('<script src="gears_init.js"><\/script>');</script>
<script src="geolocation.js"></script>
<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script>
    $(document).ready(function () {

    });
    function MarkYourLocation() {
        if (navigator.geolocation) {

            navigator.geolocation.getCurrentPosition(success, error, { enableHighAccuracy: true, maximumAge: 1000 });
        } else {
            error(); // no support http://www.google.com/chromeframe
        }
    }

    function success(position) {

        //        alert('Your location has been identified.');

        var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

        var options = {
            zoom: 16,
            center: latlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        var map = new google.maps.Map(document.getElementById("map"), options);

        var marker = new google.maps.Marker({
            position: latlng,
            map: map,
            title: "You are Checked in Here"
        });

        var location =
                {
                    lat: position.coords.latitude,
                    lon: position.coords.longitude,
                }

        $.post('@Url.Action("SaveLocation", "Home")', location,
                    function (response) {
                        if (response.Success == false) {
                            alert("Location found, but there was an error saving the data.  " + response.Message);
                        }
                        else {
                            // Make any extra updates to the UI here

                        }
                    }
                );
    }

    function error() {
        var response = window.confirm('Your Current Location Could Not Be Determined. Press \'OK\' to add plugin to your browser to repair this issue.');
        if (response) {
            document.location.reload("http://www.google.com/chromeframe");
        }
    }

</script>
<style>
    * {
        margin: 0;
        padding: 0;
    }

    html, body {
        height: 100%;
    }


    #map {
        max-height: 95%;
        min-height: 400px;
        width: 100%;
        background-color: #ccc;
    }
</style>
<div id="map"></div>
<div class="row">
    <div class="span12">
        <a href="#" class="btn btn-primary" id="SetLocation" onclick="javascript:MarkYourLocation()">
            Set Current Location</a>
    </div>
</div>
